var wgo=angular.module("wgo",["ngRoute","720kb.socialshare","ngSanitize"]);wgo.config(["$routeProvider","$locationProvider",function(t){t.when("/",{controller:"IndexController",templateUrl:"js/views/home.html"}).when("/login",{controller:"LoginController",templateUrl:"js/views/login.html"}).when("/register",{controller:"RegisterController",templateUrl:"js/views/register.html"}).when("/create",{controller:"CreateController",templateUrl:"js/views/create.html"}).when("/:id/edit",{controller:"EditController",templateUrl:"js/views/edit.html"}).when("/:city",{controller:"CityController",templateUrl:"js/views/city.html"}).when("/:city/:id",{controller:"CityEvent",templateUrl:"js/views/event.html"}).when("/:city/tags/:tag",{controller:"TagController",templateUrl:"js/views/tag.html"}).otherwise({redirectTo:"/"})}]),$(document).on("click",".show-event-info",function(){console.log("ddsd"),$(".event-info-container").toggleClass("mobile-event-info-display")}),$(document).on("click",".if-optional-price-exists",function(){$(".optional-price").toggleClass("display-optional-price")}),wgo.controller("IndexController",["$scope","$rootScope","$http","City",function(t,e,n,r){e.meta="Välkommen till What's going on! Här kan du finna event, händelser och aktiviteter i din närhet som passar stora så som små. Det finns alltid något att göra!",r.get().success(function(e){t.cities=e})}]),wgo.controller("RegisterController",["$scope","$http","Register",function(t,e,n){t.register=function(){n.post(t.registerData).success(function(){}).error(function(){})}}]),wgo.controller("LoginController",["$scope","$http","Login",function(t,e,n){t.login=function(){n.post(t.loginData).success(function(){}).error(function(){})}}]),wgo.controller("CityController",["$scope","$rootScope","$http","$routeParams","Events","City",function(t,e,n,r,o,i){t.city=r.city,t.status=!0,e.title=r.city+"!",e.meta="Ta reda på vad som händer i "+r.city+"! Sök bland konserter, yoga events, agilitytävlingar eller vad du än söker. Allt som händer i "+r.city+" finner du här!",o.get(r).success(function(e){t.status=!0,t.events=e.events,t.cityImage=e.cityImage,t.currentPage=0,t.pageSize=9,t.numberOfPages=function(){return Math.ceil(t.events.length/t.pageSize)}}).error(function(){i.get().success(function(e){t.cities=e}),t.status=!1}),t.orderProp="date.date"}]),wgo.controller("CityEvent",["$scope","$rootScope","$http","$routeParams","Event",function(t,e,n,r,o){t.routeParams=r,t.status=!0,o.get(r).success(function(n){t.event=n.event,t.tags=n.tags,e.metaDesc="Upplev "+n.event.title+" själv den "+n.event.date.date,e.metaImg="http://www.whatsgoingon.se/"+n.event.img.url+".jpg",e.title=n.event.title+"!",t.status=!0}).error(function(){t.status=!1})}]),wgo.controller("TagController",["$scope","$http","$routeParams","Tag","Event",function(t,e,n,r){t.city=n.city,t.tag=n.tag,r.get(n).success(function(e){t.events=e.events}).error(function(){}),t.orderProp="date.date"}]),wgo.controller("CreateController",["$scope","$http","Create",function(t,e,n){n.get().success(function(e){t.tags=e.tags,t.cities=e.cities,t.date=new Date,t.images=e.images,t.selected=e.cities[0].id}).error(function(){}),t.submitEvent=function(){var t=$("#event_page").val(),e=new RegExp("^(http|https)://");e.test(t)||(t="http://"+t);var r=$("#createForm").serialize();n.save(r+"&event_page="+t).success(function(){}).error(function(){})}}]),wgo.controller("EditController",["$scope","$http","$routeParams","Edit",function(t,e,n,r){r.get(n).success(function(e){t.tags=e.tags,t.cities=e.cities,t.event=e.event,t.current_tags=e.current_tags,t.optional_categories=e.optional_categories,t.selected_optional=e.current_categories,t.images=e.images,t.currentImage={id:e.event.img_id},t.selected={id:e.event.city_id},t.selectedValues=[],t.selected_tags=e.current_tags,angular.forEach(e.current_tags,function(e){t.selectedValues.push({id:e})}),angular.forEach(t.cities,function(e){return t.event.city_id===e.id?(t.cityName=e.name,!1):void 0})}).error(function(){}),t.submitEvent=function(){var t=$("#editForm").serialize();r.save(t,n).success(function(){}).error(function(){})}}]),wgo.controller("UserEvent",["$scope","$http","MailTip",function(t,e,n){t.userSubmitEvent=function(t){n.save(t).success(function(){}).error(function(t){$("body").append(t)})}}]),wgo.factory("City",["$http",function(t){return{get:function(){return t.get("api")}}}]),wgo.factory("Register",["$http",function(t){return{post:function(e){return t({method:"POST",url:"api/auth/register",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})}}}]),wgo.factory("Login",["$http",function(t){return{post:function(e){return t({method:"POST",url:"api/auth/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})}}}]),wgo.factory("Events",["$http",function(t){return{get:function(e){return t.get("api/"+e.city)}}}]),wgo.factory("MailTip",["$http",function(t){return{save:function(e){return t({method:"POST",url:"api/mailtip",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(e)})}}}]),wgo.factory("Event",["$http",function(t){return{get:function(e){return t.get("api/"+e.city+"/"+e.id)}}}]),wgo.factory("Tag",["$http",function(t){return{get:function(e){return t.get("api/"+e.city+"/tags/"+e.tag)}}}]),wgo.factory("Create",["$http",function(t){return{get:function(){return t.get("api/events/create")},save:function(e){return t({method:"POST",url:"api/events",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e})}}}]),wgo.factory("Edit",["$http",function(t){return{get:function(e){return t.get("api/events/"+e.id+"/edit")},save:function(e,n){return t({method:"PUT",url:"api/events/"+n.id,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e})}}}]),wgo.filter("costFilter",function(){return function(t){return 0===t?"Gratis":t+" kr"}}),wgo.filter("ageFilter",function(){return function(t){return 0===t?"Alla åldrar":t+" år"}}),wgo.filter("dateToISO",function(){return function(t){return Date.parse(t)}}),wgo.filter("cut",function(){return function(t,e,n,r){if(!t)return"";if(n=parseInt(n,10),!n)return t;if(t.length<=n)return t;if(t=t.substr(0,n),e){var o=t.lastIndexOf(" ");-1!=o&&(t=t.substr(0,o))}return t+(r||" …")}}),wgo.filter("startFrom",function(){return function(t,e){return t&&t.length?(e=+e,t.slice(e)):void 0}});